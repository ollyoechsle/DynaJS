window.Dyna={app:{},util:{},ui:{},model:{},events:{}};if(!Function.prototype.bind){Function.prototype.bind=function(b){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var a=Array.prototype.slice,f=a.call(arguments,1),e=this,c=function(){},d=function(){return e.apply(this instanceof c?this:b||window,f.concat(a.call(arguments)))};c.prototype=this.prototype;d.prototype=new c();return d}}Object.extend=function(c,a){var d=a.prototype;for(var b in d){if(d.hasOwnProperty(b)){c.prototype[b]=d[b]}}c.prototype.superclass=d};function log(){console&&console.log.apply(window,arguments)}(function(a){function b(){this._subscribers=[]}b.prototype._subscribers=null;b.prototype.on=function(e,d){var c=typeof d;if(c==="undefined"){throw new Error("CustomEvent: Subscriber cannot be undefined")}if(c!=="function"){throw new Error("CustomEvent: Subscriber must be a function")}this._subscribers.push({fn:d,event:e})};b.prototype.fire=function(g){for(var f=0,c=this._subscribers.length;f<c;f++){var h=this._subscribers[f];if(h.event===g){var e=[];for(var d=1;d<arguments.length;d++){e.push(arguments[d])}h.fn.apply(null,e)}}};b.prototype.un=function(g,e){var d,c=this._subscribers.length,f,h=[];for(d=0;d<c;d++){f=this._subscribers[d];if(f.fn===g||f.context===e){}else{h.push(f)}}this._subscribers=h};b.prototype.unsubscribeAll=function(){this._subscribers=[]};a.events.CustomEvent=b})(window.Dyna);(function(b){function a(d,e,c){log("Creating map "+d);this.name=d;this.width=e;this.height=c;this._buildLevel()}a.prototype.name=null;a.prototype.width=null;a.prototype.height=null;a.prototype.data=null;a.prototype._buildLevel=function(){var d=[],e;for(var f=0;f<this.height;f++){e=[];for(var c=0;c<this.width;c++){if(c%2==1&&f%2==1){e.push(a.WALL)}else{e.push(a.EARTH)}}d.push(e)}this.data=d};a.prototype.findPositionFor=function(c){c.x=0;c.y=0};a.prototype.tileAt=function(c,d){return this.data[c][d]};a.EARTH="earth";a.WALL="wall";b.model.Map=a})(window.Dyna);(function(b){function a(c){this.superclass.constructor.call(this);log("Creating player "+c);this.name=c}Object.extend(a,b.events.CustomEvent);a.prototype.name=null;a.prototype.withControls=function(c){c.on(a.UP,this.move.bind(this));c.on(a.DOWN,this.move.bind(this));c.on(a.LEFT,this.move.bind(this));c.on(a.RIGHT,this.move.bind(this));return this};a.prototype.move=function(){log("Player is moving")};a.UP="up";a.DOWN="down";a.LEFT="left";a.RIGHT="right";b.model.Player=a})(window.Dyna);(function(d,e){function b(){this.superclass.constructor.call(this);this._init()}Object.extend(b,d.events.CustomEvent);var c=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var a={"38":"up","40":"down","37":"left","39":"right","13":"enter","9":"tab","27":"esc","190":".","191":"/"};b.prototype._init=function(){log("Initialising keyboard events",this._subscribers);e(document).keydown(this._handleKeyDown.bind(this))};b.prototype._handleKeyDown=function(f){var i=f.keyCode,g,h;log(i);if(i>=65&&i<=90){g=c[i-65]}else{if(i>=48&&i<=57){g=i-48}else{g=a[i]}}if(g!==undefined){h=this.fire("keydown",g,f)}};d.util.Keyboard=b})(window.Dyna,jQuery);(function(b){function a(c,d){log("Creating mapview for  "+d.name);this.jContainer=c;this.map=d;this.initialise()}a.prototype.map=null;a.prototype.jContainer=null;a.prototype.tileSize=30;a.prototype.tileTemplate=null;a.prototype.initialise=function(){log("Initialising map view");this.tileSize=30;this.initialiseMap()};a.prototype.initialiseMap=function(){this.jContainer.css("width",this.tileSize*this.map.width).css("height",this.tileSize*this.map.height);this.tileTemplate=jQuery("<div class='tile'></div>")};a.prototype.getTile=function(d,c,e){return this.tileTemplate.clone().addClass(d).css("left",c*this.tileSize).css("top",e*this.tileSize)};a.prototype.updateAll=function(){var d=document.createDocumentFragment();for(var e=0;e<this.map.height;e++){for(var c=0;c<this.map.width;c++){d.appendChild(this.getTile(this.map.tileAt(c,e),c,e)[0])}}this.jContainer.empty().append(d)};b.ui.MapView=a})(window.Dyna);(function(a){function b(d,c){log("Starting Dyna Game on map "+d.name);this.players=[];this.map=d;this.mapView=c;this._initialiseEvents()}b.prototype.players=null;b.prototype.map=null;b.prototype.mapView=null;b.prototype._initialiseEvents=function(){a.app.GlobalEvents.on("pause",this.pause.bind(this))};b.prototype.pause=function(){log("Game paused")};b.prototype.addPlayer=function(c){this.players.push(c);this.map.findPositionFor(c);log("Game has "+this.players.length+" player(s)")};b.prototype.start=function(){this.mapView.updateAll()};a.app.Game=b})(window.Dyna);(function(b){function a(c,d){this.superclass.constructor.call(this);if(!d){throw new Error("Cannot create keyboard input without actions")}log("Starting Keyboard Input with actions "+d);c.on("keydown",this.handleKeyPress.bind(this));this.actions=d}Object.extend(a,b.events.CustomEvent);a.prototype.actions=null;a.prototype.handleKeyPress=function(c){log("Keyboard input handling key press for "+c);var d=this.actions[c];d&&this.fire(d)};b.app.KeyboardInput=a})(window.Dyna);(function(a){function b(){log("Initialising DynaJS");a.app.GlobalEvents=new a.events.CustomEvent();var g=new a.model.Map("Level 1",11,11),f=new a.ui.MapView(jQuery("#map"),g),d=new a.app.Game(g,f),c=new a.util.Keyboard(),e=a.model.Player;d.addPlayer(new e("Player1").withControls(new a.app.KeyboardInput(c,{up:e.UP,down:e.DOWN,left:e.LEFT,right:e.RIGHT})));d.start()}jQuery(document).ready(b)})(window.Dyna);